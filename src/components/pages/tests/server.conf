    ┌──────────────────────────────────────────────────────────────────────┐
    │                 • MobaXterm Personal Edition v24.0 •                 │
    │               (SSH client, X server and network tools)               │
    │                                                                      │
    │ ⮞ SSH session to root@207.148.64.43                                  │
    │   • Direct SSH      :  ✓                                             │
    │   • SSH compression :  ✓                                             │
    │   • SSH-browser     :  ✓                                             │
    │   • X11-forwarding  :  ✓  (remote display is forwarded through SSH)  │
    │                                                                      │
    │ ⮞ For more info, ctrl+click on help or visit our website.            │
    └──────────────────────────────────────────────────────────────────────┘

Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-174-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

  System information as of Mon 15 Apr 2024 02:56:06 PM UTC

  System load:             0.08
  Usage of /:              39.5% of 22.88GB
  Memory usage:            29%
  Swap usage:              3%
  Processes:               151
  Users logged in:         0
  IPv4 address for enp1s0: 207.148.64.43
  IPv6 address for enp1s0: 2401:c080:1400:4513:5400:4ff:fedc:3710

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

 * Introducing Expanded Security Maintenance for Applications.
   Receive updates to over 25,000 software packages with your
   Ubuntu Pro subscription. Free for personal use.

     https://ubuntu.com/pro

Expanded Security Maintenance for Applications is not enabled.

5 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status

New release '22.04.3 LTS' available.
Run 'do-release-upgrade' to upgrade to it.


*** System restart required ***
Last login: Mon Apr 15 13:17:29 2024 from 171.227.250.208
root@vultr:~# apt-get install python3-certbot-nginx
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  python3-pyparsing
Suggested packages:
  python-certbot-nginx-doc python-pyparsing-doc
The following NEW packages will be installed:
  python3-certbot-nginx python3-pyparsing
0 upgraded, 2 newly installed, 0 to remove and 3 not upgraded.
Need to get 112 kB of archives.
After this operation, 591 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://archive.ubuntu.com/ubuntu focal/main amd64 python3-pyparsing all 2.4.6-1 [61.3 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 python3-certbot-nginx all 0.40.0-0ubuntu0.1 [50.8 kB]
Fetched 112 kB in 2s (61.7 kB/s)
Selecting previously unselected package python3-pyparsing.
(Reading database ... 121443 files and directories currently installed.)
Preparing to unpack .../python3-pyparsing_2.4.6-1_all.deb ...
Unpacking python3-pyparsing (2.4.6-1) ...
Selecting previously unselected package python3-certbot-nginx.
Preparing to unpack .../python3-certbot-nginx_0.40.0-0ubuntu0.1_all.deb ...
Unpacking python3-certbot-nginx (0.40.0-0ubuntu0.1) ...
Setting up python3-pyparsing (2.4.6-1) ...
Setting up python3-certbot-nginx (0.40.0-0ubuntu0.1) ...
root@vultr:~# nginx -t && nginx -s reload
nginx: [emerg] duplicate location "/" in /etc/nginx/conf.d/myapp.conf:10
nginx: configuration file /etc/nginx/nginx.conf test failed
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
nginx: [error] invalid PID number "" in "/run/nginx.pid"
root@vultr:~# sudo killall nginx
nginx: no process found
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
nginx: [error] invalid PID number "" in "/run/nginx.pid"
root@vultr:~# ^C
root@vultr:~# invalid PID number "" in "/run/nginx.pid"
invalid: command not found
root@vultr:~# sudo service nginx start
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t
nginx: [emerg] duplicate location "/" in /etc/nginx/conf.d/myapp.conf:10
nginx: configuration file /etc/nginx/nginx.conf test failed
root@vultr:~# nginx -t
nginx: [emerg] duplicate location "/" in /etc/nginx/conf.d/myapp.conf:10
nginx: configuration file /etc/nginx/nginx.conf test failed
root@vultr:~# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# sudo certbot --nginx -d dailyenglishdictation.com www.dailyenglishdictation.com
usage:
  certbot [SUBCOMMAND] [options] [-d DOMAIN] [-d DOMAIN] ...

Certbot can obtain and install HTTPS/TLS/SSL certificates.  By default,
it will attempt to use a webserver both for obtaining and installing the
certificate.
certbot: error: unrecognized arguments: www.dailyenglishdictation.com
root@vultr:~# sudo certbot --nginx -d dailyenglishdictation.com -d www.dailyenglishdictation.com
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for dailyenglishdictation.com
http-01 challenge for www.dailyenglishdictation.com
Waiting for verification...
Cleaning up challenges
Deploying Certificate to VirtualHost /etc/nginx/conf.d/myapp.conf
Deploying Certificate to VirtualHost /etc/nginx/conf.d/myapp.conf

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Redirecting all traffic on port 80 to ssl in /etc/nginx/conf.d/myapp.conf
Redirecting all traffic on port 80 to ssl in /etc/nginx/conf.d/myapp.conf

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations! You have successfully enabled https://dailyenglishdictation.com
and https://www.dailyenglishdictation.com

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=dailyenglishdictation.com
https://www.ssllabs.com/ssltest/analyze.html?d=www.dailyenglishdictation.com
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/dailyenglishdictation.com/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/dailyenglishdictation.com/privkey.pem
   Your cert will expire on 2024-07-14. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot again
   with the "certonly" option. To non-interactively renew *all* of
   your certificates, run "certbot renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le

root@vultr:~# crontab -e
no crontab for root - using an empty one

Select an editor.  To change later, run 'select-editor'.
  1. /bin/nano        <---- easiest
  2. /usr/bin/vim.basic
  3. /usr/bin/vim.tiny
  4. /bin/ed

Choose 1-4 [1]: 1
crontab: installing new crontab
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# snap version
snap    2.61.3+20.04
snapd   2.61.3+20.04
series  16
ubuntu  20.04
kernel  5.4.0-174-generic
root@vultr:~# sudo snap install certbot --classic
certbot 2.10.0 from Certbot Project (certbot-eff✓) installed
root@vultr:~# sudo ln -s /snap/bin/certbot /usr/bin/certbot
ln: failed to create symbolic link '/usr/bin/certbot': File exists
root@vultr:~# sudo certbot --nginx -d dailyenglishdictation.com -d www.dailyenglishdictation.com
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx
Cert not yet due for renewal

You have an existing certificate that has exactly the same domains or certificate name you requested and isn't close to expiry.
(ref: /etc/letsencrypt/renewal/dailyenglishdictation.com.conf)

What would you like to do?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: Attempt to reinstall this existing certificate
2: Renew & replace the cert (limit ~5 per 7 days)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 1
Keeping the existing certificate
Deploying Certificate to VirtualHost /etc/nginx/conf.d/myapp.conf
Deploying Certificate to VirtualHost /etc/nginx/conf.d/myapp.conf

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Redirecting all traffic on port 80 to ssl in /etc/nginx/conf.d/myapp.conf
Redirecting all traffic on port 80 to ssl in /etc/nginx/conf.d/myapp.conf

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations! You have successfully enabled https://dailyenglishdictation.com
and https://www.dailyenglishdictation.com

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=dailyenglishdictation.com
https://www.ssllabs.com/ssltest/analyze.html?d=www.dailyenglishdictation.com
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/dailyenglishdictation.com/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/dailyenglishdictation.com/privkey.pem
   Your cert will expire on 2024-07-14. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot again
   with the "certonly" option. To non-interactively renew *all* of
   your certificates, run "certbot renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le

root@vultr:~# sudo systemctl status snap.certbot.renew.service
● snap.certbot.renew.service - Service for snap application certbot.renew
     Loaded: loaded (/etc/systemd/system/snap.certbot.renew.service; static; vendor preset: enabled)
     Active: inactive (dead)
TriggeredBy: ● snap.certbot.renew.timer
root@vultr:~# sudo certbot renew --dry-run
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Processing /etc/letsencrypt/renewal/dailyenglishdictation.com.conf
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Cert not due for renewal, but simulating renewal for dry run
Plugins selected: Authenticator nginx, Installer nginx
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for dailyenglishdictation.com
http-01 challenge for www.dailyenglishdictation.com
Waiting for verification...
Cleaning up challenges

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
new certificate deployed with reload of nginx server; fullchain is
/etc/letsencrypt/live/dailyenglishdictation.com/fullchain.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates below have not been saved.)

Congratulations, all renewals succeeded. The following certs have been renewed:
  /etc/letsencrypt/live/dailyenglishdictation.com/fullchain.pem (success)
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates above have not been saved.)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Your account credentials have been saved in your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.
root@vultr:~# sudo apt install net-tools
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  net-tools
0 upgraded, 1 newly installed, 0 to remove and 3 not upgraded.
Need to get 196 kB of archives.
After this operation, 864 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal/main amd64 net-tools amd64 1.60+git20180626.aebd88e-1ubuntu1 [196 kB]
Fetched 196 kB in 1s (135 kB/s)
Selecting previously unselected package net-tools.
(Reading database ... 121485 files and directories currently installed.)
Preparing to unpack .../net-tools_1.60+git20180626.aebd88e-1ubuntu1_amd64.deb ...
Unpacking net-tools (1.60+git20180626.aebd88e-1ubuntu1) ...
Setting up net-tools (1.60+git20180626.aebd88e-1ubuntu1) ...
Processing triggers for man-db (2.9.1-1) ...
root@vultr:~# sudo netstat -tunlp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      65948/nginx: master
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      65948/nginx: master
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      716/systemd-resolve
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      941/sshd: /usr/sbin
tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      15550/postgres
tcp        0      0 127.0.0.1:6010          0.0.0.0:*               LISTEN      64512/sshd: root@pt
tcp6       0      0 :::80                   :::*                    LISTEN      65948/nginx: master
tcp6       0      0 :::22                   :::*                    LISTEN      941/sshd: /usr/sbin
tcp6       0      0 :::3000                 :::*                    LISTEN      51193/next-server
tcp6       0      0 ::1:5432                :::*                    LISTEN      15550/postgres
tcp6       0      0 ::1:6010                :::*                    LISTEN      64512/sshd: root@pt
udp        0      0 127.0.0.53:53           0.0.0.0:*                           716/systemd-resolve
udp        0      0 207.148.64.43:68        0.0.0.0:*                           788/systemd-network
root@vultr:~# nginx -t && nginx -s reload
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:~# sudo nano /etc/nginx/snippets/ssl-toidicafe.vn.conf
root@vultr:~# sudo nano /etc/nginx/snippets/ssl-dailyenglishdictation.conf
root@vultr:~# sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
Generating DH parameters, 2048 bit long safe prime, generator 2
This is going to take a long time
..............................................................................+..................................+.................................................................................+............................................+.......................................................................+..............................................................................+..............................................................................................................................+............+..............................................+........................................+.........................................................+................................+...............+.......................................+.........................................................................................................+...............+...................................................................+.................................................................................+...............+............................................................................................................................................+................+..........................+..............................................+..................................................................................................................................................+.................................++*++*++*++*
root@vultr:~#
root@vultr:~# sudo nano /etc/nginx/snippets/ssl-params.conf
root@vultr:~#
